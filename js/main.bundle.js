(()=>{"use strict";var e,t;t=10,(e=1)<0||t<0||(t<e&&([e,t]=[t,e]),Math.floor(Math.random()*(t-e+1))),((e,t,n)=>{const o=_.random(1.1,1.2,!0),r=Math.pow(10,10);Math.round(o*r)})();const n=e=>"Esc"===e.key||"Escape"===e.key,o=document.querySelector("#error").content,r=document.createDocumentFragment(),a=document.querySelector("#success").content,c=document.createDocumentFragment(),s=()=>{const e=document.querySelector(".error"),t=document.querySelector(".success");e&&e.remove(),t&&t.remove()};document.addEventListener("click",(()=>{s()}));const l=document.querySelector("#title");l.addEventListener("input",(()=>{const e=l.value.length;e<30?l.setCustomValidity("Введите ещё "+(30-e)+" симв."):e>100?l.setCustomValidity("Удалите лишние "+(e-100)+" симв."):l.setCustomValidity(""),l.reportValidity()}));const i=document.querySelector("#type"),d=document.querySelector("#price"),u=()=>{switch(i.value){case"bungalow":d.min=0,d.placeholder="0";break;case"flat":d.min=1e3,d.placeholder="1000";break;case"house":d.min=5e3,d.placeholder="5000";break;case"palace":d.min=1e4,d.placeholder="10000"}};i.addEventListener("change",u);const p=1e6,m=document.querySelector("#price");m.addEventListener("input",(()=>{parseInt(m.value)>p?m.setCustomValidity("Максимальная цена "+p):m.setCustomValidity(""),m.reportValidity()})),u(),((e,t)=>{const n=document.getElementById("timein"),o=document.getElementById("timeout"),r=_.bind((function(){o.value=this.value}),n),a=_.bind((function(){n.value=this.value}),o);n.addEventListener("change",r),o.addEventListener("change",a)})(),(()=>{const e=document.getElementById("room_number"),t=document.getElementById("capacity");function n(e){t.querySelectorAll("option").forEach((e=>{e.disabled=!1})),1===e?(t.value="1",o(t,["2","3","0"])):2===e?o(t,["3","0"]):3===e?o(t,["0"]):100===e&&(t.value="0",o(t,["1","2","3"]))}function o(e,t){e.querySelectorAll("option").forEach((e=>{t.includes(e.value)&&(e.disabled=!0)}))}e.addEventListener("change",(()=>{n(parseInt(e.value))})),n(parseInt(e.value))})();const y=["jpg","jpeg","png"],g=document.querySelector("#avatar"),h=document.querySelector(".ad-form-header__preview"),v=h.querySelector("img");g.addEventListener("change",(()=>{const e=g.files[0],t=e.name.toLowerCase();if(y.some((e=>t.endsWith(e)))){const t=new FileReader;t.addEventListener("load",(()=>{v.src=t.result,v.removeAttribute("width"),v.removeAttribute("height"),h.style.padding="0px",h.style.display="flex",h.style.flexShrink="0",h.style.justifyContent="center",h.style.alignItems="center",h.style.overflow="hidden",v.style.maxHeight="100%"})),t.readAsDataURL(e)}}));const f=document.querySelector("#images"),S=document.querySelector(".ad-form__photo");f.addEventListener("change",(()=>{const e=f.files[0],t=new FileReader;["image/png","image/jpeg","image/jpg"].some((t=>e.type===t))&&(t.addEventListener("load",(()=>{const e=new Image;e.src=t.result,e.addEventListener("load",(()=>{const n=S.clientWidth,o=S.clientHeight;let r=e.width,a=e.height;if(r>n){const e=n/r;r=n,a*=e}if(a>o){const e=o/a;a=o,r*=e}S.style.backgroundImage=`url(${t.result})`,S.style.backgroundSize=`${r}px ${a}px`,S.style.backgroundRepeat="no-repeat",S.style.backgroundPosition="center",S.style.padding="0px",S.style.display="flex",S.style.justifyContent="center",S.style.alignItems="center",S.style.overflow="hidden"}))})),t.readAsDataURL(e))}));const q=document.querySelector(".ad-form"),b=q.querySelectorAll("input, select, textarea, button"),E=document.querySelector(".map__filters"),k=E.querySelectorAll("input, select, textarea, button"),w=()=>{q.classList.add("ad-form--disabled"),b.forEach((e=>{e.disabled=!0})),E.classList.add("map__filters--disabled"),k.forEach((e=>{e.disabled=!0}))};w();const x=document.querySelector(".ad-form");document.querySelector(".ad-form__reset").addEventListener("click",(()=>{q.reset(),F()}));const C=document.querySelector("#card").content.querySelector(".popup"),A={flat:"Квартира",bungalow:"Бунгало",house:"Дом",palace:"Дворец"};let I,M,j;const T=document.querySelector("#address"),V=e=>{M=e;try{j=L.map("map-canvas").setView({lat:35.6895,lng:139.69171},9),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(j);const e=L.icon({iconUrl:"img/main-pin.svg",iconSize:[52,52],iconAnchor:[26,52]}),t={lat:35.6895,lng:139.69171};I=L.marker(t,{draggable:!0,icon:e}),I.addTo(j);const n=I.getLatLng(),o=$(n.lat,n.lng);T.value=o,I.on("mousemove",(e=>{const t=e.target.getLatLng(),n=$(t.lat,t.lng);T.value=n}));const r=document.querySelector("#housing-type"),a=document.querySelector("#housing-price"),c=document.querySelector("#housing-rooms"),s=document.querySelector("#housing-guests"),l=document.querySelector("#housing-features"),i=()=>{const e=r.value,t=a.value,n=c.value,o=s.value,i=Array.from(l.querySelectorAll("input:checked")).map((e=>e.value));let d=((e,t)=>e.filter((e=>{const n=e.offer.type;return"any"===t||n===t})))(M,e);d=((e,t)=>e.filter((e=>{const n=e.offer.price;switch(t){case"low":return n<1e4;case"middle":return n>=1e4&&n<=5e4;case"high":return n>5e4;default:return!0}})))(d,t),d=((e,t)=>"any"===t?e:e.filter((e=>e.offer.rooms===parseInt(t,10))))(d,n),d=((e,t)=>"any"===t?e:e.filter((e=>e.offer.guests===parseInt(t,10))))(d,o),d=((e,t)=>e.filter((e=>t.every((t=>e.offer.features.includes(t))))))(d,i),D(d)};r.addEventListener("change",i),a.addEventListener("change",i),c.addEventListener("change",i),s.addEventListener("change",i),l.addEventListener("change",i),i(),q.classList.remove("ad-form--disabled"),b.forEach((e=>{e.removeAttribute("disabled")})),E.classList.remove("map__filters--disabled"),k.forEach((e=>{e.removeAttribute("disabled")}))}catch(e){throw w(),new Error("Не удалось инициализировать карту")}},F=()=>{if(I){const e={lat:35.6895,lng:139.69171};I.setLatLng(e)}},$=(e,t)=>`${e.toFixed(5)}, ${t.toFixed(5)}`,D=e=>{j.eachLayer((e=>{e instanceof L.Marker&&j.removeLayer(e)}));const t=L.icon({iconUrl:"img/main-pin.svg",iconSize:[52,52],iconAnchor:[26,52]});I=L.marker({lat:35.6895,lng:139.69171},{draggable:!0,icon:t}),I.addTo(j),I.on("mousemove",(e=>{const t=e.target.getLatLng(),n=$(t.lat,t.lng);T.value=n})),e.slice(0,10).forEach((e=>{const{lat:t,lng:n}=e.location,o=L.icon({iconUrl:"img/pin.svg",iconSize:[40,40],iconAnchor:[20,40]});L.marker({lat:t,lng:n},{icon:o}).addTo(j).bindPopup((({offer:e,author:t,location:n})=>{const o=C.cloneNode(!0);o.querySelector(".popup__title").textContent=e.title,o.querySelector(".popup__text--address").textContent=`${n.lat}, ${n.lng}`,o.querySelector(".popup__text--price").textContent=e.price+" ₽/ночь";const r=A[e.type];o.querySelector(".popup__type").textContent=r,o.querySelector(".popup__text--capacity").textContent=e.rooms+" комнаты для "+e.guests+" гостей",o.querySelector(".popup__text--time").textContent="Заезд после "+e.checkin+", выезд до "+e.checkout;const a=o.querySelector(".popup__features");var c,s;c=e.features,(s=a).innerHTML="",c.forEach((e=>{const t=document.createElement("li");t.classList.add("popup__feature"),t.classList.add("popup__feature--"+e),s.appendChild(t)})),o.querySelector(".popup__description").textContent=e.description;const l=o.querySelector(".popup__photos");var i,d;return i=e.photos,(d=l).innerHTML="",i.forEach((e=>{const t=document.createElement("img");t.classList.add("popup__photo"),t.src=e,t.width="45",t.height="40",t.alt="Фотография жилья",d.appendChild(t)})),o.querySelector(".popup__avatar").src=t.avatar,o})(e),{keepInView:!0})}))};fetch("https://22.javascript.pages.academy/keksobooking/data").then((e=>e.json())).then((e=>{(e=>{V(e)})(e)})),x.addEventListener("submit",(e=>{var t,l;e.preventDefault(),t=()=>(()=>{const e=o.cloneNode(!0);e.querySelector(".error__message").innerHTML="Ошибка размещения<br>объявления";const t=e.querySelector(".error__button");t.textContent="Попробовать снова",e.querySelector(".error").addEventListener("click",(e=>{e.target.classList.contains("error")&&s()})),t.addEventListener("click",(()=>{s()})),document.addEventListener("keydown",(e=>{n(e)&&s()})),r.appendChild(e),document.body.appendChild(r)})(),l=new FormData(e.target),fetch("https://22.javascript.pages.academy/keksobooking",{method:"POST",body:l}).then((e=>{e.ok?((()=>{const e=a.cloneNode(!0);e.querySelector(".success__message").innerHTML="Ваше объявление<br>успешно размещено!",e.querySelector(".success").addEventListener("click",(e=>{e.target.classList.contains("success")&&s()})),document.addEventListener("keydown",(e=>{n(e)&&s()})),c.appendChild(e),document.body.appendChild(c)})(),F()):t()})).catch((()=>{t()})),x.reset()}))})();
//# sourceMappingURL=main.bundle.js.map