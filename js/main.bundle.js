(()=>{"use strict";var e,t;t=10,(e=1)<0||t<0||(t<e&&([e,t]=[t,e]),Math.floor(Math.random()*(t-e+1))),((e,t,n)=>{const o=_.random(1.1,1.2,!0),r=Math.pow(10,10);Math.round(o*r)})();const n=e=>"Esc"===e.key||"Escape"===e.key,o=document.querySelector("#error").content,r=document.createDocumentFragment(),a=document.querySelector("#success").content,s=document.createDocumentFragment(),c=()=>{const e=document.querySelector(".error"),t=document.querySelector(".success");e&&e.remove(),t&&t.remove()};document.addEventListener("click",(()=>{c()}));const l=document.querySelector("#title");l.addEventListener("input",(()=>{const e=l.value.length;e<30?l.setCustomValidity("Введите ещё "+(30-e)+" симв."):e>100?l.setCustomValidity("Удалите лишние "+(e-100)+" симв."):l.setCustomValidity(""),l.reportValidity()}));const i=document.querySelector("#type"),d=document.querySelector("#price"),u=()=>{switch(i.value){case"bungalow":d.min=0,d.placeholder="0";break;case"flat":d.min=1e3,d.placeholder="1000";break;case"house":d.min=5e3,d.placeholder="5000";break;case"palace":d.min=1e4,d.placeholder="10000"}};i.addEventListener("change",u);const p=1e6,y=document.querySelector("#price");y.addEventListener("input",(()=>{parseInt(y.value)>p?y.setCustomValidity("Максимальная цена "+p):y.setCustomValidity(""),y.reportValidity()})),u(),((e,t)=>{const n=document.getElementById("timein"),o=document.getElementById("timeout"),r=_.bind((function(){o.value=this.value}),n),a=_.bind((function(){n.value=this.value}),o);n.addEventListener("change",r),o.addEventListener("change",a)})(),(()=>{const e=document.getElementById("room_number"),t=document.getElementById("capacity");function n(e){t.querySelectorAll("option").forEach((e=>{e.disabled=!1})),1===e?(t.value="1",o(t,["2","3","0"])):2===e?o(t,["3","0"]):3===e?o(t,["0"]):100===e&&(t.value="0",o(t,["1","2","3"]))}function o(e,t){e.querySelectorAll("option").forEach((e=>{t.includes(e.value)&&(e.disabled=!0)}))}e.addEventListener("change",(()=>{n(parseInt(e.value))})),n(parseInt(e.value))})();const m=["jpg","jpeg","png"],g="img/muffin-grey.svg",h=document.querySelector("#avatar"),f=document.querySelector(".ad-form-header__preview"),v=f.querySelector("img");h.addEventListener("change",(()=>{const e=h.files[0],t=e.name.toLowerCase();if(m.some((e=>t.endsWith(e)))){const t=new FileReader;t.addEventListener("load",(()=>{v.src=t.result,v.removeAttribute("width"),v.removeAttribute("height"),f.style.padding="0px",f.style.display="flex",f.style.flexShrink="0",f.style.justifyContent="center",f.style.alignItems="center",f.style.overflow="hidden",v.style.maxHeight="100%"})),t.readAsDataURL(e)}}));const S=document.querySelector("#images"),b=document.querySelector(".ad-form__photo");S.addEventListener("change",(()=>{const e=S.files[0],t=new FileReader;["image/png","image/jpeg","image/jpg"].some((t=>e.type===t))&&(t.addEventListener("load",(()=>{const e=new Image;e.src=t.result,e.addEventListener("load",(()=>{const n=b.clientWidth,o=b.clientHeight;let r=e.width,a=e.height;if(r>n){const e=n/r;r=n,a*=e}if(a>o){const e=o/a;a=o,r*=e}b.style.backgroundImage=`url(${t.result})`,b.style.backgroundSize=`${r}px ${a}px`,b.style.backgroundRepeat="no-repeat",b.style.backgroundPosition="center",b.style.padding="0px",b.style.display="flex",b.style.justifyContent="center",b.style.alignItems="center",b.style.overflow="hidden"}))})),t.readAsDataURL(e))}));const q=document.querySelector(".ad-form"),k=q.querySelectorAll("input, select, textarea, button"),E=document.querySelector(".map__filters"),w=E.querySelectorAll("input, select, textarea, button"),x=()=>{q.classList.add("ad-form--disabled"),k.forEach((e=>{e.disabled=!0})),E.classList.add("map__filters--disabled"),w.forEach((e=>{e.disabled=!0}))};x(),document.querySelector(".ad-form__reset").addEventListener("click",(e=>{e.preventDefault(),q.reset(),v.src=g,v.setAttribute("width","40"),v.setAttribute("height","44"),f.style.padding="0px",f.style.display="flex",f.style.flexShrink="0",f.style.justifyContent="center",f.style.alignItems="center",f.style.overflow="hidden",b.style.backgroundImage="",b.style.backgroundSize="",b.style.backgroundRepeat="",b.style.backgroundPosition="",b.style.padding="",b.style.display="",b.style.justifyContent="",b.style.alignItems="",b.style.overflow="",b.innerHTML="",z()}));const C=document.querySelector(".ad-form"),I=document.querySelector("#card").content.querySelector(".popup"),A={flat:"Квартира",bungalow:"Бунгало",house:"Дом",palace:"Дворец"};let j,M,T;const V=document.querySelector("#address"),H=e=>{M=e;try{T=L.map("map-canvas").setView({lat:35.6895,lng:139.69171},9),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(T);const e=L.icon({iconUrl:"img/main-pin.svg",iconSize:[52,52],iconAnchor:[26,52]}),t={lat:35.6895,lng:139.69171};j=L.marker(t,{draggable:!0,icon:e}),j.addTo(T);const n=j.getLatLng(),o=D(n.lat,n.lng);V.value=o,j.on("mousemove",(e=>{const t=e.target.getLatLng(),n=D(t.lat,t.lng);V.value=n}));const r=document.querySelector("#housing-type"),a=document.querySelector("#housing-price"),s=document.querySelector("#housing-rooms"),c=document.querySelector("#housing-guests"),l=document.querySelector("#housing-features"),i=()=>{const e=r.value,t=a.value,n=s.value,o=c.value,i=Array.from(l.querySelectorAll("input:checked")).map((e=>e.value));let d=((e,t)=>e.filter((e=>{const n=e.offer.type;return"any"===t||n===t})))(M,e);d=((e,t)=>e.filter((e=>{const n=e.offer.price;switch(t){case"low":return n<1e4;case"middle":return n>=1e4&&n<=5e4;case"high":return n>5e4;default:return!0}})))(d,t),d=((e,t)=>"any"===t?e:e.filter((e=>e.offer.rooms===parseInt(t,10))))(d,n),d=((e,t)=>"any"===t?e:e.filter((e=>e.offer.guests===parseInt(t,10))))(d,o),d=((e,t)=>e.filter((e=>t.every((t=>e.offer.features.includes(t))))))(d,i),F(d)};r.addEventListener("change",i),a.addEventListener("change",i),s.addEventListener("change",i),c.addEventListener("change",i),l.addEventListener("change",i),i(),q.classList.remove("ad-form--disabled"),k.forEach((e=>{e.removeAttribute("disabled")})),E.classList.remove("map__filters--disabled"),w.forEach((e=>{e.removeAttribute("disabled")}))}catch(e){throw x(),new Error("Не удалось инициализировать карту")}},z=()=>{if(j){const e={lat:35.6895,lng:139.69171};j.setLatLng(e)}},D=(e,t)=>`${e.toFixed(5)}, ${t.toFixed(5)}`,F=e=>{T.eachLayer((e=>{e instanceof L.Marker&&T.removeLayer(e)}));const t=L.icon({iconUrl:"img/main-pin.svg",iconSize:[52,52],iconAnchor:[26,52]});j=L.marker({lat:35.6895,lng:139.69171},{draggable:!0,icon:t}),j.addTo(T),j.on("mousemove",(e=>{const t=e.target.getLatLng(),n=D(t.lat,t.lng);V.value=n})),e.slice(0,10).forEach((e=>{const{lat:t,lng:n}=e.location,o=L.icon({iconUrl:"img/pin.svg",iconSize:[40,40],iconAnchor:[20,40]});L.marker({lat:t,lng:n},{icon:o}).addTo(T).bindPopup((({offer:e,author:t,location:n})=>{const o=I.cloneNode(!0);o.querySelector(".popup__title").textContent=e.title,o.querySelector(".popup__text--address").textContent=`${n.lat}, ${n.lng}`,o.querySelector(".popup__text--price").textContent=e.price+" ₽/ночь";const r=A[e.type];o.querySelector(".popup__type").textContent=r,o.querySelector(".popup__text--capacity").textContent=e.rooms+" комнаты для "+e.guests+" гостей",o.querySelector(".popup__text--time").textContent="Заезд после "+e.checkin+", выезд до "+e.checkout;const a=o.querySelector(".popup__features");var s,c;s=e.features,(c=a).innerHTML="",s.forEach((e=>{const t=document.createElement("li");t.classList.add("popup__feature"),t.classList.add("popup__feature--"+e),c.appendChild(t)})),o.querySelector(".popup__description").textContent=e.description;const l=o.querySelector(".popup__photos");var i,d;return i=e.photos,(d=l).innerHTML="",i.forEach((e=>{const t=document.createElement("img");t.classList.add("popup__photo"),t.src=e,t.width="45",t.height="40",t.alt="Фотография жилья",d.appendChild(t)})),o.querySelector(".popup__avatar").src=t.avatar,o})(e),{keepInView:!0})}))};fetch("https://22.javascript.pages.academy/keksobooking/data").then((e=>e.json())).then((e=>{(e=>{H(e)})(e)})),C.addEventListener("submit",(e=>{var t,l;e.preventDefault(),t=()=>(()=>{const e=o.cloneNode(!0);e.querySelector(".error__message").innerHTML="Ошибка размещения<br>объявления";const t=e.querySelector(".error__button");t.textContent="Попробовать снова",e.querySelector(".error").addEventListener("click",(e=>{e.target.classList.contains("error")&&c()})),t.addEventListener("click",(()=>{c()})),document.addEventListener("keydown",(e=>{n(e)&&c()})),r.appendChild(e),document.body.appendChild(r)})(),l=new FormData(e.target),fetch("https://22.javascript.pages.academy/keksobooking",{method:"POST",body:l}).then((e=>{e.ok?((()=>{const e=a.cloneNode(!0);e.querySelector(".success__message").innerHTML="Ваше объявление<br>успешно размещено!",e.querySelector(".success").addEventListener("click",(e=>{e.target.classList.contains("success")&&c()})),document.addEventListener("keydown",(e=>{n(e)&&c()})),s.appendChild(e),document.body.appendChild(s)})(),z(),v.src=g,v.setAttribute("width","40"),v.setAttribute("height","44"),f.style.padding="0px",f.style.display="flex",f.style.flexShrink="0",f.style.justifyContent="center",f.style.alignItems="center",f.style.overflow="hidden",b.style.backgroundImage="",b.style.backgroundSize="",b.style.backgroundRepeat="",b.style.backgroundPosition="",b.style.padding="",b.style.display="",b.style.justifyContent="",b.style.alignItems="",b.style.overflow="",b.innerHTML=""):t()})).catch((()=>{t()})),C.reset()}))})();
//# sourceMappingURL=main.bundle.js.map